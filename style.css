/* style.css — Unified roster + optimizer styling */

:root{
  --bg:#0b0d12;
  --panel:#121522;
  --panel2:#0f1220;
  --text:#e9ecff;
  --muted:#aab1d6;
  --line:rgba(255,255,255,.08);
  --chip:rgba(255,255,255,.10);
  --chip2:rgba(255,255,255,.16);
}

*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.hidden{display:none!important}

/* Top bar */
.topbar{position:sticky;top:0;z-index:10;background:rgba(11,13,18,.92);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);padding:10px 12px}
.topbar-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;max-width:1150px;margin:0 auto}
.brandTitle{font-weight:900;letter-spacing:.2px}
.brandSub{font-size:12px;color:var(--muted);margin-top:2px}
.tabs{display:flex;gap:8px}
.tab{border:1px solid var(--line);background:var(--panel2);color:var(--text);padding:8px 10px;border-radius:10px;font-weight:900;cursor:pointer;text-decoration:none}
.tab.active{background:var(--panel);border-color:rgba(255,255,255,.18)}
.page{padding:14px 12px 40px;max-width:1150px;margin:0 auto}

/* Controls */
.controls{display:flex;flex-wrap:wrap;gap:10px;padding:10px;border:1px solid var(--line);background:var(--panel);border-radius:12px;margin-bottom:14px}
.input{background:var(--panel2);border:1px solid var(--line);color:var(--text);border-radius:10px;padding:10px 12px;min-height:40px;outline:none}
.btn{border:1px solid var(--line);background:var(--panel2);color:var(--text);padding:10px 12px;border-radius:10px;font-weight:900;cursor:pointer}
.btn:active{transform:translateY(1px)}
#statusText{color:var(--muted);font-size:13px;margin:6px 0 10px}
.footerHint{color:var(--muted);font-size:13px;margin-top:14px}

/* Panels */
.panel{border:1px solid var(--line);background:var(--panel);border-radius:14px;padding:12px;margin-top:10px}
.panelTitle{font-weight:900;margin-bottom:6px}
.muted{color:var(--muted);font-size:13px}
.skillText{white-space:normal;line-height:1.25}
.skillLine{margin:8px 0}

/* =========================================================
   ROSTER GRID + VIEW MODES
   ========================================================= */
.rosterGrid{display:grid;gap:12px}

/* Default grid (desktop/tablet baseline) */
#unitGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
#catalogGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media (min-width:700px){#unitGrid{grid-template-columns:repeat(3,minmax(0,1fr))}#catalogGrid{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media (min-width:1000px){#unitGrid{grid-template-columns:repeat(4,minmax(0,1fr))}#catalogGrid{grid-template-columns:repeat(4,minmax(0,1fr))}}

/* =========================================================
   VIEW MODES (COMPACT vs DETAILED)
   - Works on desktop + mobile
   - Compact keeps stats + leader visible; hides heavy panels (skills/passives)
   ========================================================= */

/* Desktop + all sizes: make toggle actually change layout */
body.mobile-detailed #unitGrid,
body.mobile-detailed #catalogGrid{
  grid-template-columns:1fr!important;
  gap:12px!important;
}
body.mobile-compact #unitGrid,
body.mobile-compact #catalogGrid{
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr))!important;
  gap:12px!important;
}

/* Panels: detailed shows, compact hides */
body.mobile-detailed .unitDetails{display:block!important}
body.mobile-detailed .unitDetails .panel{display:block!important}
body.mobile-compact .unitDetails{display:block!important}
body.mobile-compact .unitDetails .panel{display:none!important}

/* Mobile tuning */
@media (max-width:900px){
  /* Compact = 3 per row on phones/tablets */
  body.mobile-compact #unitGrid,
  body.mobile-compact #catalogGrid{
    grid-template-columns:repeat(3,minmax(0,1fr))!important;
    gap:10px!important;
  }
}

 
/* Left column wrapper for catalog/roster cards (thumb + toggles) */
.unitLeft{display:flex;flex-direction:column;gap:10px;align-items:flex-start;min-width:0}
/* =========================================================
   ROSTER CARD
   ========================================================= */
.unitCard{
  border:1px solid var(--line);
  background:var(--panel);
  border-radius:14px;
  padding:12px;
  display:grid;
  grid-template-columns:88px 1fr;
  gap:12px;
  align-items:start;
  overflow:hidden;
  min-width:0;
}
.unitThumb{width:88px;height:88px;border-radius:12px;overflow:hidden;background:rgba(255,255,255,.06);display:grid;place-items:center}
.unitThumb img{width:100%;height:100%;object-fit:cover;object-position:center top;display:block}
.unitThumb .ph{width:100%;height:100%;display:grid;place-items:center;font-weight:900;font-size:28px}
.meta{display:flex;flex-direction:column;gap:8px;min-width:0}
.topRow{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
/* New, more uniform header: name on left, fixed chip column on right */
.metaHeader{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:start}
.nameBlock{min-width:0}
.chipCol{display:flex;flex-direction:column;gap:6px;align-items:flex-end;flex:0 0 auto}
.chipCol .tag{white-space:nowrap}
.unitName{font-weight:900;line-height:1.15;font-size:16px;overflow-wrap:break-word;word-break:normal}
.unitTitle,.unitSub{font-size:13px;color:var(--muted);margin-top:2px;line-height:1.2;overflow-wrap:break-word;word-break:normal}
.tags{display:flex;flex-direction:row;gap:6px;flex-wrap:wrap;align-items:center;justify-content:flex-end;min-width:0}
/* If older markup uses .tags, keep bubbles pinned to the right */
.topRow .tags{flex-direction:row;align-items:center;justify-content:flex-end}

/* Image state buttons (1/2/3) */
.stateRow{display:flex;gap:6px;align-items:center;justify-content:flex-end;flex-wrap:nowrap;margin-top:6px}
.stateRow .stateBtn{border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:var(--text);
  border-radius:10px;padding:4px 8px;font-size:12px;line-height:1;cursor:pointer}
.stateRow .stateBtn.active{background:rgba(255,255,255,.18)}
.unitDetails{display:block}
.statLine{display:flex;flex-wrap:wrap;gap:10px;font-weight:800;letter-spacing:.2px}
.stat{font-size:13px}
.stat strong{font-weight:900}

/* Leader always visible */
.leaderBlock{border-top:1px solid var(--line);padding-top:8px;display:block!important;visibility:visible!important;opacity:1!important}
.leaderName{font-weight:900;font-size:13px}
.leaderDesc{color:var(--muted);font-size:13px;margin-top:2px;line-height:1.25;overflow-wrap:break-word;word-break:normal}

.ownedRow{display:flex;align-items:center;gap:8px;padding:8px 10px;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:12px;font-weight:900}
.ownedCheck{width:18px;height:18px}

/* Compact card tweak (general) */
body.mobile-compact .unitCard{grid-template-columns:72px 1fr;gap:10px;padding:10px}
body.mobile-compact .unitThumb{width:72px;height:72px;border-radius:10px}

/* =========================================================
   OPTIMIZER: SLOT BOXES + GRIDS
   ========================================================= */
.optHeader{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px}
.platoonTools{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.teamBlock{margin-top:10px}
.teamSubTitle{font-weight:900;margin:8px 0 6px}

/* Story grids */
.slotGrid{display:grid;gap:10px;margin-top:8px;grid-template-columns:repeat(5,minmax(0,1fr))}
.storyBackGrid{grid-template-columns:repeat(3,minmax(0,1fr))}

/* Platoons container */
.platoonsGrid{display:grid;gap:12px;margin-top:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
@media (min-width:900px){.platoonsGrid{grid-template-columns:repeat(2,minmax(0,1fr))}}
/* Storage grid */
.grid{display:grid;gap:10px;margin-top:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
@media (min-width:700px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media (min-width:1000px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}

.slotCard{
  border:1px solid var(--line);
  background:var(--panel2);
  border-radius:12px;
  padding:10px;
  min-height:96px;
  display:grid;
  gap:8px;
  align-content:start;
  min-width:0;
}
.slotTop{display:grid;grid-template-columns:56px 1fr;gap:10px;align-items:center;min-width:0}
.slotImg{width:56px;height:56px;border-radius:10px;overflow:hidden;background:rgba(255,255,255,.06);display:grid;place-items:center}
.slotImg img{width:100%;height:100%;object-fit:cover;display:block}
.slotImg .ph{font-weight:900}
.slotName{font-weight:900;line-height:1.15;font-size:13px;overflow-wrap:break-word;word-break:normal}
.slotSub{color:var(--muted);font-size:12px;margin-top:2px;line-height:1.2;overflow-wrap:break-word;word-break:normal}
.slotMetaRow{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.slotChip{font-size:11px;padding:3px 7px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.06);white-space:nowrap}
.slotSelect{width:100%;background:rgba(255,255,255,.06);border:1px solid var(--line);color:var(--text);border-radius:10px;padding:8px 10px;outline:none}

/* =========================================================
   MOBILE (<=900px): compact card layout + optimizer grids
   ========================================================= */
@media (max-width:900px){
  /* Detailed cards (full view) — avoid ultra-narrow text columns */
  body.mobile-detailed .unitCard{
    grid-template-columns:1fr!important;
    padding:10px!important;
    gap:10px!important;
  }
  body.mobile-detailed .unitThumb{
    width:100%!important;
    height:120px!important;
    border-radius:12px!important;
  }
  body.mobile-detailed .topRow{
    flex-direction:column!important;
    align-items:flex-start!important;
    justify-content:flex-start!important;
    gap:6px!important;
  }
  body.mobile-detailed .tags{justify-content:flex-start!important}
  body.mobile-detailed .unitName{
    white-space:normal!important;
    overflow:visible!important;
    text-overflow:clip!important;
  }
  body.mobile-detailed .unitTitle{display:block!important}


  /* Compact cards (image on top + truncate) */
  body.mobile-compact .unitCard{
    grid-template-columns:1fr!important;
    padding:8px!important;
    gap:8px!important;
    border-radius:12px!important;
  }

  body.mobile-compact .unitThumb{
    width:100%!important;
    height:108px!important; /* bigger face crop */
    border-radius:10px!important;
  }

  body.mobile-compact .topRow{
    flex-direction:column!important;
    align-items:flex-start!important;
    justify-content:flex-start!important;
    gap:6px!important;
  }

  body.mobile-compact .tags{justify-content:flex-start!important}

  body.mobile-compact .unitName{
    font-size:13px!important;
    line-height:1.1!important;
    white-space:nowrap!important;
    overflow:hidden!important;
    text-overflow:ellipsis!important;
    max-width:100%!important;
  }

  body.mobile-compact .unitTitle{display:none!important}

  body.mobile-compact .ownedRow{padding:6px 8px!important;justify-content:center!important}
  body.mobile-compact .ownedRow span{display:none!important}

  /* Optimizer grids on small screens */
  .slotGrid{grid-template-columns:repeat(2,minmax(0,1fr))}
  .storyBackGrid{grid-template-columns:repeat(2,minmax(0,1fr))}
  .platoonsGrid{grid-template-columns:1fr}
  .grid{grid-template-columns:repeat(2,minmax(0,1fr))}


  /* Keep title visible in compact; truncate to 1 line */
  body.mobile-compact .unitTitle{
    display:block!important;
    font-size:12px!important;
    line-height:1.15!important;
    white-space:nowrap!important;
    overflow:hidden!important;
    text-overflow:ellipsis!important;
    max-width:100%!important;
    opacity:.9;
  }

}
/* =========================================================
   OPTIMIZER: ELEMENT COLOR CODING (PLACED UNITS)
   Guard rails:
   - Purely presentational (CSS only)
   - Driven by slotCard having class el-fire/el-water/... added by optimizer.js
   ========================================================= */
:root{
  --el-fire:#ff3b3b;
  --el-water:#2f8bff;
  --el-storm:#ffd84a;
  --el-earth:#41d26b;
  --el-light:#f4f6ff;
  --el-dark:#a855f7;
}

/* Optional: subtle modernized page background (safe override) */
body{
  background:
    radial-gradient(1200px 700px at 20% 0%, rgba(84,110,255,0.22), transparent 55%),
    radial-gradient(900px 600px at 80% 10%, rgba(168,85,247,0.16), transparent 60%),
    var(--bg);
}

.slotCard{
  position:relative; /* needed for the color rail */
  overflow:hidden;
}

/* Set --el by element */
.slotCard.el-fire  { --el:var(--el-fire); }
.slotCard.el-water { --el:var(--el-water); }
.slotCard.el-storm { --el:var(--el-storm); }
.slotCard.el-earth { --el:var(--el-earth); }
.slotCard.el-light { --el:var(--el-light); }
.slotCard.el-dark  { --el:var(--el-dark); }

/* Color rail */
.slotCard[class*="el-"]::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:8px;
  background:var(--el);
  box-shadow:inset 0 0 0 1px rgba(0,0,0,0.25);
}

/* Tint + border */
.slotCard[class*="el-"]{
  border-color: color-mix(in srgb, var(--el) 55%, var(--line));
  background: linear-gradient(
    180deg,
    color-mix(in srgb, var(--el) 10%, var(--panel2)),
    var(--panel2)
  );
}

/* Ensure readable text for Light */
.slotCard.el-light{ color: rgba(10,12,20,0.92); }
.slotCard.el-light .slotSub,
.slotCard.el-light .muted{ color: rgba(10,12,20,0.68); }
.slotCard.el-light .slotChip{
  background: rgba(255,255,255,0.55);
  border-color: rgba(10,12,20,0.15);
  color: rgba(10,12,20,0.85);
}


/* ===== Element accents for roster (mobile/desktop) without changing owned logic ===== */

/* Restore rarity/element “bubble” chips (the markup uses .tag) */
.tag{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:4px 8px;
  border-radius:999px;
  font-size:12px;
  line-height:1;
  font-weight:900;
  letter-spacing:.2px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.08);
  color:var(--text);
}
.tag.element{ text-transform:capitalize; }
.tag.rarity{ opacity:.95; }

/* Element chip tint follows the card’s element class */
.unitCard.el-fire  .tag.element{ border-color:color-mix(in srgb, var(--el-fire) 60%, rgba(255,255,255,.18)); background:color-mix(in srgb, var(--el-fire) 16%, rgba(255,255,255,.08)); }
.unitCard.el-water .tag.element{ border-color:color-mix(in srgb, var(--el-water) 60%, rgba(255,255,255,.18)); background:color-mix(in srgb, var(--el-water) 16%, rgba(255,255,255,.08)); }
.unitCard.el-storm .tag.element{ border-color:color-mix(in srgb, var(--el-storm) 60%, rgba(255,255,255,.18)); background:color-mix(in srgb, var(--el-storm) 16%, rgba(255,255,255,.08)); }
.unitCard.el-earth .tag.element{ border-color:color-mix(in srgb, var(--el-earth) 60%, rgba(255,255,255,.18)); background:color-mix(in srgb, var(--el-earth) 16%, rgba(255,255,255,.08)); }
.unitCard.el-light .tag.element{ border-color:rgba(10,12,20,.20); background:rgba(255,255,255,.70); color:rgba(10,12,20,.88); }
.unitCard.el-dark  .tag.element{ border-color:color-mix(in srgb, var(--el-dark) 60%, rgba(255,255,255,.18)); background:color-mix(in srgb, var(--el-dark) 16%, rgba(255,255,255,.08)); }

/* Optional rarity emphasis (kept neutral, no logic changes) */
.tag.rarity{ background:rgba(255,255,255,.10); }

/* Make the whole card read as the unit’s element (mobile expectation: “entire square”) */
.unitCard{ position:relative; }
.unitCard.el-fire,
.unitCard.el-water,
.unitCard.el-storm,
.unitCard.el-earth,
.unitCard.el-light,
.unitCard.el-dark{ --el: transparent; }
.unitCard.el-fire  { --el: var(--el-fire); }
.unitCard.el-water { --el: var(--el-water); }
.unitCard.el-storm { --el: var(--el-storm); }
.unitCard.el-earth { --el: var(--el-earth); }
.unitCard.el-light { --el: var(--el-light); }
.unitCard.el-dark  { --el: var(--el-dark); }

/* Subtle tint by default; stronger on mobile-compact */
.unitCard[class*="el-"]{
  background:
    linear-gradient(180deg,
      color-mix(in srgb, var(--el) 10%, var(--panel)),
      var(--panel)
    );
  border-color: color-mix(in srgb, var(--el) 38%, var(--line));
}
@media (max-width: 560px){
  body.mobile-compact .unitCard[class*="el-"]{
    background:
      linear-gradient(180deg,
        color-mix(in srgb, var(--el) 22%, var(--panel)),
        color-mix(in srgb, var(--el) 10%, var(--panel))
      );
  }
}

/* Light element: keep roster text consistent (no black text overrides) */

.unitCard.el-fire  { border-left: 6px solid var(--el-fire);  }
.unitCard.el-water { border-left: 6px solid var(--el-water); }
.unitCard.el-storm { border-left: 6px solid var(--el-storm); }
.unitCard.el-earth { border-left: 6px solid var(--el-earth); }
.unitCard.el-light { border-left: 6px solid var(--el-light); }
.unitCard.el-dark  { border-left: 6px solid var(--el-dark);  }

.unitCard.el-fire  .ownedRow{ border-color: color-mix(in srgb, var(--el-fire) 55%, var(--line)); }
.unitCard.el-water .ownedRow{ border-color: color-mix(in srgb, var(--el-water) 55%, var(--line)); }
.unitCard.el-storm .ownedRow{ border-color: color-mix(in srgb, var(--el-storm) 55%, var(--line)); }
.unitCard.el-earth .ownedRow{ border-color: color-mix(in srgb, var(--el-earth) 55%, var(--line)); }
.unitCard.el-light .ownedRow{ border-color: color-mix(in srgb, var(--el-light) 55%, var(--line)); }
.unitCard.el-dark  .ownedRow{ border-color: color-mix(in srgb, var(--el-dark) 55%, var(--line)); }

/* Mobile compact: keep the checkbox row visually tied to element color */
@media (max-width: 560px){
  body.mobile-compact .unitCard.el-fire  .ownedRow{ box-shadow: 0 0 0 2px color-mix(in srgb, var(--el-fire) 28%, transparent); }
  body.mobile-compact .unitCard.el-water .ownedRow{ box-shadow: 0 0 0 2px color-mix(in srgb, var(--el-water) 28%, transparent); }
  body.mobile-compact .unitCard.el-storm .ownedRow{ box-shadow: 0 0 0 2px color-mix(in srgb, var(--el-storm) 28%, transparent); }
  body.mobile-compact .unitCard.el-earth .ownedRow{ box-shadow: 0 0 0 2px color-mix(in srgb, var(--el-earth) 28%, transparent); }
  body.mobile-compact .unitCard.el-light .ownedRow{ box-shadow: 0 0 0 2px color-mix(in srgb, var(--el-light) 28%, transparent); }
  body.mobile-compact .unitCard.el-dark  .ownedRow{ box-shadow: 0 0 0 2px color-mix(in srgb, var(--el-dark) 28%, transparent); }
}

/* =========================================================
   ROSTER TEXT COLOR LOCK (prevents accidental black text)
   ========================================================= */
.unitCard,
.unitCard *{
  color: var(--text) !important;
}
.unitCard .unitTitle,
.unitCard .unitSub,
.unitCard .leaderDesc{
  color: var(--muted) !important;
}

/* =========================================================
   STATE TOGGLES (CIRCLES)
   ========================================================= */
.stateRow{display:flex;gap:10px;align-items:center;justify-content:flex-start;flex-wrap:nowrap;margin-top:0}
.stateRow .stateBtn{
  width:30px;
  height:30px;
  padding:0;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.22);
  background:rgba(255,255,255,.06);
}
.stateRow .stateBtn.active{background:rgba(255,255,255,.20)}
/* If inside .unitLeft, stack vertically like the diagram */
.unitLeft .stateRow{flex-direction:column;align-items:flex-start}

/* Badges as rectangles in chip column */
.chipCol .tag{border-radius:10px;padding:6px 12px;min-height:28px}

/* =========================================================
   MOBILE GRID OVERRIDE (phones only)
   - 2 cards per row on small screens
   - Desktop/tablet rules remain untouched
   ========================================================= */
@media (max-width: 560px){
  body.mobile-compact #unitGrid,
  body.mobile-compact #catalogGrid{
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 10px !important;
  }
}

/* =========================================================
   MOBILE COMPACT: STATE TOGGLES (1–3) HORIZONTAL + CENTERED
   - Phones/tablets only (desktop untouched)
   - Forces 1/2/3 labels for consistency
   ========================================================= */
@media (max-width: 900px){
  body.mobile-compact .unitLeft .stateRow,
  body.mobile-compact .stateRow{
    flex-direction: row !important;
    justify-content: center !important;
    align-items: center !important;
    width: 100% !important;
    gap: 8px !important;
    margin-top: 0 !important;
  }

  body.mobile-compact .stateRow .stateBtn{
    display: grid !important;
    place-items: center !important;
    width: 30px !important;
    height: 30px !important;
    padding: 0 !important;
    font-size: 0 !important; /* hide any existing text, we render labels via ::before */
    font-weight: 900 !important;
  }

  body.mobile-compact .stateRow .stateBtn::before{
    font-size: 12px !important;
    line-height: 1 !important;
    color: var(--text) !important;
  }
  body.mobile-compact .stateRow .stateBtn:nth-child(1)::before{ content: "1"; }
  body.mobile-compact .stateRow .stateBtn:nth-child(2)::before{ content: "2"; }
  body.mobile-compact .stateRow .stateBtn:nth-child(3)::before{ content: "3"; }
}

/* =========================================================
   MOBILE COMPACT: SHOW FULL NAME + TITLE, CENTERED BADGES
   - Phones/tablets only (desktop untouched)
   - Badges on one centered row: Element • Character • SSR
   ========================================================= */
@media (max-width: 900px){
  body.mobile-compact .metaHeader{
    grid-template-columns: 1fr !important;   /* stack name + badges */
    justify-items: center !important;
    text-align: center !important;
    gap: 8px !important;
  }

  body.mobile-compact .nameBlock{
    width: 100% !important;
  }

  /* Show full unit name (no ellipsis) */
  body.mobile-compact .unitName{
    font-size: 14px !important;
    line-height: 1.15 !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    word-break: normal !important;
  }

  /* Show full title/subtitle (no truncation) */
  body.mobile-compact .unitTitle,
  body.mobile-compact .unitSub{
    display: block !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    max-width: 100% !important;
  }

  /* Badges row centered to eliminate wasted right-side space */
  body.mobile-compact .chipCol{
    width: 100% !important;
    flex-direction: row !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 8px !important;
  }

  /* Re-order badges: Element first, Character (non-element/non-rarity) second, SSR (rarity) third */
  body.mobile-compact .chipCol .tag.element{ order: 1 !important; }
  body.mobile-compact .chipCol .tag:not(.element):not(.rarity){ order: 2 !important; }
  body.mobile-compact .chipCol .tag.rarity{ order: 3 !important; }

  /* Keep badges compact but readable */
  body.mobile-compact .chipCol .tag{
    min-height: 24px !important;
    padding: 5px 10px !important;
  }
}

/* =========================================================
   MOBILE COMPACT: CHARACTER BADGE ON ITS OWN LINE
   - Phones/tablets only
   - Character tag centered on its own row
   - Element + SSR remain together
   ========================================================= */
@media (max-width: 900px){
  body.mobile-compact .chipCol{
    flex-direction: column !important;
    align-items: center !important;
    gap: 6px !important;
  }

  /* Row 1: Element + SSR */
  body.mobile-compact .chipCol .tag.element,
  body.mobile-compact .chipCol .tag.rarity{
    display: inline-flex !important;
  }

  /* Row 2: Character only */
  body.mobile-compact .chipCol .tag:not(.element):not(.rarity){
    order: 2 !important;
    display: inline-flex !important;
  }
}

/* =========================================================
   MOBILE COMPACT: ELEMENT + RARITY AS SOLID BARS (CENTERED)
   - Replaces chip look with clean bars like your reference
   - Character badge remains its own line
   ========================================================= */
@media (max-width: 900px){

  /* Container already centered from previous patches */
  body.mobile-compact .chipCol{
    width: 100% !important;
    align-items: center !important;
  }

  /* Element + rarity become solid bars */
  body.mobile-compact .chipCol .tag.element,
  body.mobile-compact .chipCol .tag.rarity{
    width: 70% !important;
    justify-content: center !important;
    border-radius: 12px !important;
    padding: 6px 0 !important;
    font-size: 13px !important;
    font-weight: 900 !important;
    letter-spacing: .3px !important;
    border: none !important;
    color: #fff !important;
  }

  /* Element color controls bar color */
  body.mobile-compact .unitCard.el-fire  .tag.element{ background: color-mix(in srgb, var(--el-fire) 70%, #000); }
  body.mobile-compact .unitCard.el-water .tag.element{ background: color-mix(in srgb, var(--el-water) 70%, #000); }
  body.mobile-compact .unitCard.el-storm .tag.element{ background: color-mix(in srgb, var(--el-storm) 70%, #000); color:#000 !important; }
  body.mobile-compact .unitCard.el-earth .tag.element{ background: color-mix(in srgb, var(--el-earth) 70%, #000); }
  body.mobile-compact .unitCard.el-light .tag.element{ background: #f4f6ff; color:#111 !important; }
  body.mobile-compact .unitCard.el-dark  .tag.element{ background: color-mix(in srgb, var(--el-dark) 70%, #000); }

  /* Rarity bar (neutral but strong) */
  body.mobile-compact .chipCol .tag.rarity{
    background: rgba(255,255,255,.22) !important;
  }

  /* Character badge stays smaller + separate */
  body.mobile-compact .chipCol .tag:not(.element):not(.rarity){
    width: auto !important;
    padding: 5px 14px !important;
    font-size: 12px !important;
    opacity: .9 !important;
  }
}

/* =========================================================
   MOBILE DETAILED (CATALOG): BADGE LAYOUT LIKE REFERENCE
   - Character badge on its own line (top)
   - Element + Rarity on the next line (side-by-side)
   - Does NOT affect compact mode or desktop
   ========================================================= */
@media (max-width: 900px){
  body.mobile-detailed #catalogGrid .metaHeader{
    grid-template-columns: 1fr auto !important;
    align-items: end !important;
  }

  body.mobile-detailed #catalogGrid .chipCol{
    /* allow wrapping so Character can occupy its own line */
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    justify-content: flex-end !important;
    align-items: center !important;
    gap: 8px !important;
  }

  /* Character on its own row */
  body.mobile-detailed #catalogGrid .chipCol .tag:not(.element):not(.rarity){
    flex: 0 0 100% !important;
    justify-content: flex-end !important;
    margin-bottom: 2px !important;
    order: 1 !important;
  }

  /* Element + SSR on same row */
  body.mobile-detailed #catalogGrid .chipCol .tag.element{
    order: 2 !important;
  }
  body.mobile-detailed #catalogGrid .chipCol .tag.rarity{
    order: 3 !important;
  }
}

/* =========================================================
   MOBILE DETAILED (CATALOG ONLY): TOGGLES 1–3 + ELEMENT POSITION
   - Does NOT affect desktop
   - Does NOT affect compact view
   Desired:
     - Toggle states as 1/2/3 (horizontal)
     - Badges: Character on its own line; Element + SSR side-by-side (Element first)
   ========================================================= */
@media (max-width: 900px){

  /* 1) Toggle states: horizontal row, centered, labeled 1–3 */
  body.mobile-detailed #catalogGrid .stateRow{
    flex-direction: row !important;
    justify-content: flex-start !important;  /* sits under name area like your reference */
    align-items: center !important;
    gap: 10px !important;
    margin: 8px 0 0 0 !important;
  }

  body.mobile-detailed #catalogGrid .stateRow .stateBtn{
    display: grid !important;
    place-items: center !important;
    width: 30px !important;
    height: 30px !important;
    padding: 0 !important;
    border-radius: 999px !important;
    font-size: 0 !important; /* hide any existing text */
  }

  body.mobile-detailed #catalogGrid .stateRow .stateBtn::before{
    content: "" !important;
    font-size: 12px !important;
    line-height: 1 !important;
    font-weight: 900 !important;
    color: var(--text) !important;
  }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn:nth-child(1)::before{ content: "1" !important; }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn:nth-child(2)::before{ content: "2" !important; }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn:nth-child(3)::before{ content: "3" !important; }

  /* If stateRow is inside .unitLeft, prevent vertical stacking in detailed catalog */
  body.mobile-detailed #catalogGrid .unitLeft .stateRow{
    flex-direction: row !important;
    align-items: center !important;
  }

  /* 2) Badge layout: Character line, then Element + SSR line (Element first) */
  body.mobile-detailed #catalogGrid .chipCol{
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    justify-content: flex-end !important;
    align-items: center !important;
    gap: 10px !important;
  }

  /* Character badge on its own row */
  body.mobile-detailed #catalogGrid .chipCol .tag:not(.element):not(.rarity){
    flex: 0 0 100% !important;
    order: 1 !important;
    justify-content: flex-end !important;
    margin-bottom: 2px !important;
  }

  /* Element then SSR on same row */
  body.mobile-detailed #catalogGrid .chipCol .tag.element{
    order: 2 !important;
  }
  body.mobile-detailed #catalogGrid .chipCol .tag.rarity{
    order: 3 !important;
  }
}

/* =========================================================
   MOBILE DETAILED (CATALOG ONLY): NAME + CHARACTER (ROW 1),
   TITLE + TOGGLES + (ELEMENT + RARITY) (ROW 2)
   - Locks desktop + compact: NOT affected
   - Swaps Character vs SSR placement:
       * Character = top-right (row 1)
       * SSR = next to Element (row 2) and SHORT (auto width)
   - Places toggle states BETWEEN title and badges
   ========================================================= */
@media (max-width: 900px){

  /* Make meta a 2-row, 3-column grid */
  body.mobile-detailed #catalogGrid .meta{
    display: grid !important;
    grid-template-columns: 1fr auto auto !important; /* title | toggles | badges */
    grid-template-rows: auto auto !important;
    column-gap: 12px !important;
    row-gap: 8px !important;
    align-items: end !important;
  }

  /* Let unitName + unitTitle become direct grid items */
  body.mobile-detailed #catalogGrid .nameBlock{
    display: contents !important;
  }

  /* Row 1: Name (left) */
  body.mobile-detailed #catalogGrid .unitName{
    grid-column: 1 / span 2 !important;
    grid-row: 1 !important;
    justify-self: start !important;
  }

  /* Row 2: Title (left) */
  body.mobile-detailed #catalogGrid .unitTitle{
    grid-column: 1 !important;
    grid-row: 2 !important;
    justify-self: start !important;
    margin-top: 0 !important;
  }

  /* Row 2: Toggles (middle) */
  body.mobile-detailed #catalogGrid .stateRow{
    grid-column: 2 !important;
    grid-row: 2 !important;
    justify-self: center !important;
    align-self: center !important;
    margin: 0 !important;
  }

  /* Column 3: Badges container spans both rows */
  body.mobile-detailed #catalogGrid .chipCol{
    grid-column: 3 !important;
    grid-row: 1 / span 2 !important;

    display: grid !important;
    grid-template-rows: auto auto !important; /* row1: Character, row2: Element+SSR */
    justify-items: end !important;
    align-items: center !important;
    row-gap: 10px !important;
    width: auto !important;
  }

  /* Character badge (top-right) */
  body.mobile-detailed #catalogGrid .chipCol .tag:not(.element):not(.rarity){
    grid-row: 1 !important;
    justify-self: end !important;
  }

  /* Element + SSR on same row (row 2) */
  body.mobile-detailed #catalogGrid .chipCol .tag.element{
    grid-row: 2 !important;
    justify-self: start !important;
  }
  body.mobile-detailed #catalogGrid .chipCol .tag.rarity{
    grid-row: 2 !important;
    justify-self: end !important;

    /* Make SSR SHORT (no full-width bar) */
    width: auto !important;
    min-width: 0 !important;
    padding-left: 12px !important;
    padding-right: 12px !important;
  }

  /* Ensure Element appears left of SSR on row 2 */
  body.mobile-detailed #catalogGrid .chipCol{
    grid-template-columns: auto auto !important;
  }
  body.mobile-detailed #catalogGrid .chipCol .tag.element{ grid-column: 1 !important; }
  body.mobile-detailed #catalogGrid .chipCol .tag.rarity{ grid-column: 2 !important; }

  /* Small safety: prevent the earlier "full-width rarity bar" look from leaking into detailed */
  body.mobile-detailed #catalogGrid .chipCol .tag.element,
  body.mobile-detailed #catalogGrid .chipCol .tag.rarity{
    border: 1px solid rgba(255,255,255,.18) !important;
    background: rgba(255,255,255,.08) !important;
    border-radius: 12px !important;
  }
}

/* =========================================================
   MOBILE DETAILED (CATALOG ONLY) — STRICT PLACEMENT FIX
   Goal layout (3-column header row under image):
     Row1: hero image (full width)
     Row2: Name (col1-2) | Badges (col3)
     Row3: Title (col1) | Toggles 1-3 (col2) | Badges (col3)
     Row4+: Stats / Leader / etc (full width)
   Badges (col3):
     - Top line: Character (longer)
     - Bottom line: Element + SSR (Element first, SSR short)
   Notes:
     - Compact view untouched
     - Desktop untouched
   ========================================================= */
@media (max-width: 900px){
  body.mobile-detailed #catalogGrid .unitCard{
    display: grid !important;
    grid-template-columns: 1fr auto auto !important;
    grid-template-rows: auto auto auto auto auto !important;
    grid-template-areas:
      "thumb thumb thumb"
      "name  name  badges"
      "title toggles badges"
      "stats stats stats"
      "leader leader leader" !important;
    gap: 10px !important;
  }

  /* Flatten wrappers so children can be placed by the card grid */
  body.mobile-detailed #catalogGrid .unitLeft{ display: contents !important; }
  body.mobile-detailed #catalogGrid .meta{ display: contents !important; }
  body.mobile-detailed #catalogGrid .metaHeader{ display: contents !important; }
  body.mobile-detailed #catalogGrid .nameBlock{ display: contents !important; }

  /* Hero */
  body.mobile-detailed #catalogGrid .unitThumb{ grid-area: thumb !important; }

  /* Name + title */
  body.mobile-detailed #catalogGrid .unitName{
    grid-area: name !important;
    align-self: end !important;
    margin: 0 !important;
  }
  body.mobile-detailed #catalogGrid .unitTitle{
    grid-area: title !important;
    display: block !important;
    align-self: start !important;
    margin: 0 !important;
  }

  /* Toggles in the "between" space */
  body.mobile-detailed #catalogGrid .stateRow{
    grid-area: toggles !important;
    justify-content: center !important;
    align-items: center !important;
    margin: 0 !important;
  }

  /* Ensure toggles are numbered 1–3 */
  body.mobile-detailed #catalogGrid .stateRow .stateBtn{
    font-size: 0 !important;
  }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn::before{
    font-size: 12px !important;
    font-weight: 900 !important;
    color: var(--text) !important;
  }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn:nth-child(1)::before{ content:"1" !important; }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn:nth-child(2)::before{ content:"2" !important; }
  body.mobile-detailed #catalogGrid .stateRow .stateBtn:nth-child(3)::before{ content:"3" !important; }

  /* Stats + leader occupy full width rows */
  body.mobile-detailed #catalogGrid .statLine{
    grid-area: stats !important;
    margin-top: 2px !important;
  }
  body.mobile-detailed #catalogGrid .leaderBlock{
    grid-area: leader !important;
  }

  /* Badges column */
  body.mobile-detailed #catalogGrid .chipCol{
    grid-area: badges !important;
    display: grid !important;
    grid-template-columns: auto auto !important;
    grid-template-rows: auto auto !important;
    grid-template-areas:
      "character character"
      "element   rarity" !important;
    gap: 10px !important;
    justify-items: end !important;
    align-items: center !important;
  }

  /* Swap so Character is the top long badge */
  body.mobile-detailed #catalogGrid .chipCol .tag:not(.element):not(.rarity){
    grid-area: character !important;
    justify-self: end !important;
  }

  /* Element + SSR on the lower line (Element first) */
  body.mobile-detailed #catalogGrid .chipCol .tag.element{
    grid-area: element !important;
    justify-self: end !important;
  }
  body.mobile-detailed #catalogGrid .chipCol .tag.rarity{
    grid-area: rarity !important;
    justify-self: end !important;
    width: auto !important;        /* SSR short */
    min-width: 0 !important;
    padding-left: 12px !important;
    padding-right: 12px !important;
  }

  /* Prevent any earlier "full-width bar" styling in detailed */
  body.mobile-detailed #catalogGrid .chipCol .tag{
    border-radius: 12px !important;
    border: 1px solid rgba(255,255,255,.18) !important;
    background: rgba(255,255,255,.08) !important;
  }
}

/* =========================================================
   MOBILE COMPACT (CATALOG/UNIT GRID): RESTORE CLEAN STACK
   Required layout:
     Image
     Toggles (1–3) horizontal + centered (under image)
     Name (above) + Title (below)
     Badges on separate lines: Character, Element, Rarity (centered)
   ========================================================= */
@media (max-width: 900px){

  /* Make compact cards a simple vertical stack */
  body.mobile-compact #catalogGrid .unitCard,
  body.mobile-compact #unitGrid .unitCard{
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
  }

  /* Image first */
  body.mobile-compact #catalogGrid .unitThumb,
  body.mobile-compact #unitGrid .unitThumb{
    order: 1 !important;
  }

  /* Toggles directly under image, centered, horizontal */
  body.mobile-compact #catalogGrid .stateRow,
  body.mobile-compact #unitGrid .stateRow{
    order: 2 !important;
    width: 100% !important;
    flex-direction: row !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 10px !important;
    margin: 10px 0 6px 0 !important;
  }

  /* Header stack: name/title centered, badges below */
  body.mobile-compact #catalogGrid .metaHeader,
  body.mobile-compact #unitGrid .metaHeader{
    order: 3 !important;
    grid-template-columns: 1fr !important;
    justify-items: center !important;
    text-align: center !important;
    gap: 8px !important;
  }

  body.mobile-compact #catalogGrid .unitName,
  body.mobile-compact #unitGrid .unitName{
    margin-top: 2px !important;
  }

  body.mobile-compact #catalogGrid .unitTitle,
  body.mobile-compact #unitGrid .unitTitle{
    margin-top: 2px !important;
  }

  /* Badges: separate lines, centered; order = Character, Element, Rarity */
  body.mobile-compact #catalogGrid .chipCol,
  body.mobile-compact #unitGrid .chipCol{
    width: 100% !important;
    align-items: center !important;
    justify-content: center !important;
    flex-direction: column !important;
    gap: 8px !important;
  }

  body.mobile-compact #catalogGrid .chipCol .tag,
  body.mobile-compact #unitGrid .chipCol .tag{
    width: 70% !important;
    justify-content: center !important;
    text-align: center !important;
  }

  body.mobile-compact #catalogGrid .chipCol .tag:not(.element):not(.rarity),
  body.mobile-compact #unitGrid .chipCol .tag:not(.element):not(.rarity){
    order: 1 !important; /* Character/Weapon/Boss */
  }
  body.mobile-compact #catalogGrid .chipCol .tag.element,
  body.mobile-compact #unitGrid .chipCol .tag.element{
    order: 2 !important;
  }
  body.mobile-compact #catalogGrid .chipCol .tag.rarity,
  body.mobile-compact #unitGrid .chipCol .tag.rarity{
    order: 3 !important;
  }
}

/* =========================================================
   MOBILE DETAILED (CATALOG): MORE SQUARE PHOTO + FULL-WIDTH TEXT
   - Compact view remains locked by earlier rules
   - Makes hero image taller (more square) to show more
   - Pushes content lower and lets leader text use full width
   ========================================================= */
@media (max-width: 900px){

  /* More square hero image (taller) */
  body.mobile-detailed #catalogGrid .unitThumb,
  body.mobile-detailed #unitGrid .unitThumb{
    height: clamp(240px, 62vw, 360px) !important;
  }

  body.mobile-detailed #catalogGrid .unitThumb img,
  body.mobile-detailed #unitGrid .unitThumb img{
    object-fit: cover !important;
    object-position: center top !important;
  }

  /* Add breathing room under the image so the block sits lower */
  body.mobile-detailed #catalogGrid .unitThumb,
  body.mobile-detailed #unitGrid .unitThumb{
    margin-bottom: 10px !important;
  }

  /* Ensure leader text uses full width and wraps */
  body.mobile-detailed #catalogGrid .leaderBlock,
  body.mobile-detailed #unitGrid .leaderBlock,
  body.mobile-detailed #catalogGrid .leaderDesc,
  body.mobile-detailed #unitGrid .leaderDesc{
    width: 100% !important;
    max-width: 100% !important;
  }

  body.mobile-detailed #catalogGrid .leaderDesc,
  body.mobile-detailed #unitGrid .leaderDesc{
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    overflow-wrap: anywhere !important;
    line-height: 1.25 !important;
  }

  /* Give the bottom a bit more usable space */
  body.mobile-detailed #catalogGrid .unitCard,
  body.mobile-detailed #unitGrid .unitCard{
    padding-bottom: 14px !important;
  }

  body.mobile-detailed #catalogGrid .statLine,
  body.mobile-detailed #unitGrid .statLine{
    margin-bottom: 6px !important;
  }
}

/* =========================================================
   MOBILE DETAILED (CATALOG): STATS 2-LINE + CENTERED LEADER TEXT
   - Does NOT change name/title/toggles/badges placement
   - Only reforms stat block + leader block formatting
   ========================================================= */
@media (max-width: 900px){

  body.mobile-detailed #catalogGrid .statLine,
  body.mobile-detailed #unitGrid .statLine{
    width: 100% !important;
    display: grid !important;
    grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
    gap: 14px !important;
    justify-items: center !important;
    align-items: start !important;
    margin-top: 8px !important;
  }

  body.mobile-detailed #catalogGrid .stat,
  body.mobile-detailed #unitGrid .stat{
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: flex-start !important;
    text-align: center !important;
    min-width: 0 !important;
  }

  body.mobile-detailed #catalogGrid .statLabel,
  body.mobile-detailed #unitGrid .statLabel{
    display: block !important;
    font-weight: 900 !important;
    letter-spacing: .6px !important;
    font-size: 14px !important;
    line-height: 1.05 !important;
  }

  body.mobile-detailed #catalogGrid .statVal,
  body.mobile-detailed #unitGrid .statVal{
    display: block !important;
    margin-top: 4px !important;
    font-weight: 900 !important;
    font-size: 22px !important;
    letter-spacing: .2px !important;
    line-height: 1.05 !important;
  }

  /* Leader skill centered and allowed to use full width */
  body.mobile-detailed #catalogGrid .leaderBlock,
  body.mobile-detailed #unitGrid .leaderBlock{
    width: 100% !important;
    max-width: 100% !important;
    text-align: center !important;
    margin-top: 10px !important;
  }

  body.mobile-detailed #catalogGrid .leaderName,
  body.mobile-detailed #unitGrid .leaderName{
    font-weight: 900 !important;
    letter-spacing: .2px !important;
  }

  body.mobile-detailed #catalogGrid .leaderDesc,
  body.mobile-detailed #unitGrid .leaderDesc{
    width: 100% !important;
    max-width: 100% !important;
    text-align: center !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    overflow-wrap: anywhere !important;
    line-height: 1.25 !important;
  }
}

/* =========================================================
   MOBILE COMPACT: IMAGE FILL
   - Only affects the image area so it fills the empty top space
   - Keeps compact layout otherwise locked
   ========================================================= */
@media (max-width: 900px){

  body.mobile-compact #catalogGrid .unitThumb,
  body.mobile-compact #unitGrid .unitThumb{
    height: clamp(180px, 46vw, 280px) !important;
  }

  body.mobile-compact #catalogGrid .unitThumb img,
  body.mobile-compact #unitGrid .unitThumb img{
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    object-position: center top !important;
    display: block !important;
  }
}

/* =========================================================
   MOBILE DETAILED: LEADER TEXT USES FULL CARD WIDTH (UNBUNDLED)
   Strict: does NOT touch name/title/toggles/badges layout.
   Expands the leader skill block to fill the red-squiggle area.
   ========================================================= */
@media (max-width: 900px){

  body.mobile-detailed #catalogGrid .leaderBlock,
  body.mobile-detailed #unitGrid .leaderBlock{
    width: 100% !important;
    max-width: none !important;
    align-self: stretch !important;
    justify-self: stretch !important;
    margin-top: 8px !important;
    padding: 0 10px 6px 10px !important;
    text-align: center !important;
  }

  body.mobile-detailed #catalogGrid .leaderName,
  body.mobile-detailed #unitGrid .leaderName{
    width: 100% !important;
    max-width: none !important;
    margin: 6px auto 6px auto !important;
    text-align: center !important;
  }

  body.mobile-detailed #catalogGrid .leaderDesc,
  body.mobile-detailed #unitGrid .leaderDesc{
    width: 100% !important;
    max-width: none !important;
    margin: 0 auto !important;
    text-align: center !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    overflow-wrap: anywhere !important;
    word-break: break-word !important;
    line-height: 1.3 !important;
  }

  /* If any container is constraining content to a narrow column, force it to stretch */
  body.mobile-detailed #catalogGrid .meta,
  body.mobile-detailed #unitGrid .meta,
  body.mobile-detailed #catalogGrid .metaBody,
  body.mobile-detailed #unitGrid .metaBody{
    max-width: none !important;
    width: 100% !important;
  }
}

/* === AUTO-PATCH: DETAIL VIEW STATS/LAYOUT FIX === */

/* =========================================================
   FIX: MOBILE DETAILED DETAILS REGION (STATS/LEADER) NOT PLACED
   - Does NOT affect name/title/toggles/badges
   - Prevents stat overlap by giving unitDetails the correct grid area
   ========================================================= */
@media (max-width: 900px){

  /* Put the whole details section in the "stats" row of the unitCard grid */
  body.mobile-detailed #catalogGrid .unitCard .unitDetails,
  body.mobile-detailed #unitGrid .unitCard .unitDetails{
    grid-area: stats !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  /* If leader is inside unitDetails, keep it spanning full width */
  body.mobile-detailed #catalogGrid .unitCard .leaderBlock,
  body.mobile-detailed #unitGrid .unitCard .leaderBlock{
    grid-column: 1 / -1 !important;
    width: 100% !important;
    max-width: none !important;
  }

  /* HARDEN stats to 2-line layout even when markup is just .stat + <strong>LABEL</strong> VALUE */
  body.mobile-detailed #catalogGrid .unitCard .statLine,
  body.mobile-detailed #unitGrid .unitCard .statLine{
    display: grid !important;
    grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
    gap: 14px !important;
    width: 100% !important;
    margin-top: 8px !important;
    align-items: start !important;
    justify-items: center !important;
  }

  body.mobile-detailed #catalogGrid .unitCard .statLine .stat,
  body.mobile-detailed #unitGrid .unitCard .statLine .stat{
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    text-align: center !important;
    min-width: 0 !important;
  }

  /* LABEL line */
  body.mobile-detailed #catalogGrid .unitCard .statLine .stat strong,
  body.mobile-detailed #unitGrid .unitCard .statLine .stat strong{
    display: block !important;
    font-size: 14px !important;
    line-height: 1.05 !important;
    letter-spacing: .6px !important;
  }

  /* VALUE line (the text node after <strong>) */
  body.mobile-detailed #catalogGrid .unitCard .statLine .stat,
  body.mobile-detailed #unitGrid .unitCard .statLine .stat{
    font-size: 22px !important;        /* value inherits here if it's plain text */
    line-height: 1.05 !important;
    font-weight: 900 !important;
  }

  /* But keep the label from inheriting the large value size */
  body.mobile-detailed #catalogGrid .unitCard .statLine .stat strong,
  body.mobile-detailed #unitGrid .unitCard .statLine .stat strong{
    font-weight: 900 !important;
  }
}

/* =========================================================
   OPTIMIZER → PLATOONS: vertical unit cards (portrait + dropdown + title + badges)
   ========================================================= */
.platoonSlots{
  display:flex;
  gap:10px;
  flex-wrap:nowrap;
  /* Do not clip the 5th platoon slot on narrower panels */
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling: touch;
  align-items:stretch;
}

/* Platoon unit card: vertical, centered, tight */
.platoonSlots .slotCard{
  width: 120px;
  max-width: 120px;
  padding: 8px;
  border-radius: 12px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

/* Portrait frame: 56x70, crop-fill, no overflow */
.platoonSlots .slotImg{
  width:56px;
  height:70px;
  border-radius:10px;
  overflow:hidden;
  display:grid;
  place-items:center;
  background:rgba(255,255,255,.06);
}
.platoonSlots .slotImg img{
  width:100%;
  height:100%;
  object-fit:cover;
  object-position:50% 35%;
  display:block;
}

/* Dropdown where the name is */
.platoonSlots .slotSelect{
  width:100%;
  margin-top:0;
  font-size:12px;
  padding:8px 10px;
}

/* Title (sub) and badges under it */
.platoonSlots .slotSub{
  text-align:center;
  margin:0;
  font-size:11px;
  line-height:1.2;
  opacity:.9;
  max-height: 2.4em;
  overflow:hidden;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
}
.platoonSlots .slotMetaRow{
  justify-content:center;
  margin:0;
}

/* Hide the old top row layout on platoons */
.platoonSlots .slotTop{ 
  display:none;
}

/* Keep lock row compact at bottom */
.platoonSlots .slotLockRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  width:100%;
  margin-top:auto;
  gap:8px;
}
.platoonSlots .slotLockRow .muted{ font-size:12px; }




/* =========================
   Optimizer Platoons UI (tinted + readable)
   Scoped to #platoonsGrid
   ========================= */
#platoonsGrid.platoonsGrid{
  display: grid;
  grid-template-columns: repeat(2, minmax(360px, 1fr));
  gap: 16px;
}

#platoonsGrid .platoonBlock{
  background: rgba(16, 18, 32, 0.55);
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 14px;
  padding: 12px;
}

#platoonsGrid .platoonSlots{
  display: flex;
  gap: 10px;
  flex-wrap: nowrap;
  /* Same as above, but scoped to #platoonsGrid */
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
}

#platoonsGrid .platoonSlotCard{
  width: 120px;
  min-width: 120px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(18, 20, 34, 0.40);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

#platoonsGrid .platoonSlotCard .slotTop{
  padding: 10px 10px 0 10px;
  display: flex;
  justify-content: center;
}

#platoonsGrid .platoonSlotCard .slotImg{
  width: 56px;
  height: 70px;
  border-radius: 12px;
  overflow: hidden;
  background: rgba(255,255,255,0.06);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.10);
}

#platoonsGrid .platoonSlotCard .unitPortrait{
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: 50% 35%;
  display: block;
}

#platoonsGrid .platoonSlotCard .unitPortraitPlaceholder{
  width: 100%;
  height: 100%;
  display:flex;
  align-items:center;
  justify-content:center;
  color: rgba(255,255,255,0.70);
  font-weight: 800;
}

#platoonsGrid .platoonSlotCard .slotMid{
  padding: 8px 10px 10px 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

#platoonsGrid .platoonSlotCard .slotSelect{
  width: 100%;
  font-size: 12px;
  line-height: 1.2;
  padding: 6px 8px;
  border-radius: 10px;
}

#platoonsGrid .platoonSlotCard .slotTitle{
  font-size: 11px;
  line-height: 1.15;
  color: rgba(255,255,255,0.80);
  min-height: 26px;
  text-align: center;
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
}

#platoonsGrid .platoonSlotCard .slotBadges{
  display: flex;
  gap: 6px;
  justify-content: center;
  flex-wrap: wrap;
}

#platoonsGrid .platoonSlotCard .tag{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.2px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.07);
  color: rgba(255,255,255,0.88);
}

#platoonsGrid .platoonSlotCard .tag.kind{
  opacity: 0.85;
}

#platoonsGrid .platoonSlotCard .tag.rarity.ssr{
  background: rgba(255,255,255,0.10);
}

#platoonsGrid .platoonSlotCard .tag.element.fire{ background: rgba(255, 80, 80, 0.22); border-color: rgba(255, 80, 80, 0.35); }
#platoonsGrid .platoonSlotCard .tag.element.water{ background: rgba(80, 160, 255, 0.22); border-color: rgba(80, 160, 255, 0.35); }
#platoonsGrid .platoonSlotCard .tag.element.storm{ background: rgba(255, 220, 80, 0.22); border-color: rgba(255, 220, 80, 0.35); }
#platoonsGrid .platoonSlotCard .tag.element.earth{ background: rgba(90, 220, 120, 0.22); border-color: rgba(90, 220, 120, 0.35); }
#platoonsGrid .platoonSlotCard .tag.element.light{ background: rgba(255, 255, 255, 0.18); border-color: rgba(255, 255, 255, 0.30); color: rgba(0,0,0,0.80); }
#platoonsGrid .platoonSlotCard.el-light .tag.element.light{ color: rgba(0,0,0,0.80); }

#platoonsGrid .platoonSlotCard .tag.element.dark{ background: rgba(170, 90, 255, 0.22); border-color: rgba(170, 90, 255, 0.35); }

#platoonsGrid .platoonSlotCard .slotBottom{
  padding: 0 10px 10px 10px;
  display: flex;
  justify-content: center;
}

#platoonsGrid .platoonSlotCard .lockRow{
  display: inline-flex;
  gap: 6px;
  align-items: center;
  font-size: 11px;
  color: rgba(255,255,255,0.82);
  user-select: none;
}

/* element tint on the card */
#platoonsGrid .platoonSlotCard.el-fire{ box-shadow: inset 0 0 0 1px rgba(255, 80, 80, 0.25); }
#platoonsGrid .platoonSlotCard.el-water{ box-shadow: inset 0 0 0 1px rgba(80, 160, 255, 0.25); }
#platoonsGrid .platoonSlotCard.el-storm{ box-shadow: inset 0 0 0 1px rgba(255, 220, 80, 0.25); }
#platoonsGrid .platoonSlotCard.el-earth{ box-shadow: inset 0 0 0 1px rgba(90, 220, 120, 0.25); }
#platoonsGrid .platoonSlotCard.el-light{ box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.18); }
#platoonsGrid .platoonSlotCard.el-dark{ box-shadow: inset 0 0 0 1px rgba(170, 90, 255, 0.25); }

/* Story (5+3) slots: match the same element-colored card scheme used in platoons */
#storyMain .storySlotCard.el-fire,
#storyBack .storySlotCard.el-fire{ box-shadow: inset 0 0 0 1px rgba(255, 80, 80, 0.25); }
#storyMain .storySlotCard.el-water,
#storyBack .storySlotCard.el-water{ box-shadow: inset 0 0 0 1px rgba(80, 160, 255, 0.25); }
#storyMain .storySlotCard.el-storm,
#storyBack .storySlotCard.el-storm{ box-shadow: inset 0 0 0 1px rgba(255, 220, 80, 0.25); }
#storyMain .storySlotCard.el-earth,
#storyBack .storySlotCard.el-earth{ box-shadow: inset 0 0 0 1px rgba(90, 220, 120, 0.25); }
#storyMain .storySlotCard.el-light,
#storyBack .storySlotCard.el-light{ box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.18); color: rgba(10,12,20,.90); }
#storyMain .storySlotCard.el-dark,
#storyBack .storySlotCard.el-dark{ box-shadow: inset 0 0 0 1px rgba(170, 90, 255, 0.25); }

/* Light element: ensure readable text inside story cards */
#storyMain .storySlotCard.el-light .slotName,
#storyBack .storySlotCard.el-light .slotName,
#storyMain .storySlotCard.el-light .slotMid,
#storyBack .storySlotCard.el-light .slotMid{ color: rgba(10,12,20,.90); }

/* tighter on smaller screens */
@media (max-width: 900px){
  #platoonsGrid.platoonsGrid{ grid-template-columns: 1fr; }
  #platoonsGrid .platoonSlots{ justify-content: space-between; }
}



/* =========================================================
   Optimizer controls (missing base styles)
   ========================================================= */
.panelRow{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:flex-end;
  justify-content:space-between;
}
.optMode{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.pill{
  border:1px solid var(--line);
  background:var(--panel2);
  color:var(--text);
  padding:10px 12px;
  border-radius:999px;
  font-weight:900;
  cursor:pointer;
}
.pill.active{
  background:rgba(255,255,255,0.08);
  border-color:rgba(255,255,255,0.18);
}
.pill:active{transform:translateY(1px)}

/* =========================================================
   Optimizer layout: remove horizontal scrolling for platoon slots
   (use wrapping grids instead)
   ========================================================= */
#platoonsGrid.platoonsGrid{
  display:grid;
  grid-template-columns:repeat(2,minmax(360px,1fr));
  gap:16px;
}
#platoonsGrid .platoonSlots{
  display:grid;
  gap:10px;
  grid-template-columns:repeat(5,minmax(56px,1fr));
  align-items:stretch;
  overflow:visible !important;
}
#platoonsGrid .platoonSlotCard{
  width:auto;
  min-width:0;
}

/* =========================================================
   Mobile major rework
   ========================================================= */
@media (max-width: 720px){
  .page{padding:10px 10px 34px}

  /* Top bar: stack + full width tabs */
  .topbar{padding:10px 10px}
  .topbar-inner{
    flex-direction:column;
    align-items:stretch;
    gap:10px;
  }
  .tabs{
    width:100%;
    gap:8px;
  }
  .tab{
    flex:1;
    text-align:center;
    padding:10px 8px;
  }

  /* Panels: reduce visual noise */
  .panel{padding:12px;border-radius:14px}
  .optHeader{
    flex-direction:column;
    align-items:stretch;
    gap:10px;
  }
  .optHeader .btn{width:100%;justify-content:center}

  .panelRow{
    flex-direction:column;
    align-items:stretch;
    gap:10px;
  }

  /* Inputs + buttons become full width */
  .btn{width:100%;justify-content:center}
  .input, select.input{
    width:100%;
  }

  /* Mode pills: 2-up */
  .optMode{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:10px;
  }
  .pill{width:100%;padding:12px 10px}

  /* Story grids: wrap instead of tiny squares */
  .slotGrid{grid-template-columns:repeat(3,minmax(0,1fr))}
  .storyBackGrid{grid-template-columns:repeat(3,minmax(0,1fr))}
  /* Slot cards: slightly tighter */
  .slotCard{border-radius:14px}
  .slotImg{height:74px}

  /* Platoons: single column, wrap slots */
  #platoonsGrid.platoonsGrid{
    grid-template-columns:1fr;
    gap:12px;
  }
  #platoonsGrid .platoonBlock{padding:12px}
  #platoonsGrid .platoonSlots{
    grid-template-columns:repeat(3,minmax(56px,1fr));
  }

  /* Storage: 1 column for readability */
  .grid{grid-template-columns:1fr}
}

@media (max-width: 420px){
  .slotGrid{grid-template-columns:repeat(2,minmax(0,1fr))}
  #platoonsGrid .platoonSlots{grid-template-columns:repeat(2,minmax(56px,1fr))}
  .tab{padding:10px 6px;font-size:13px}
}


/* =========================================================
   HOTFIX: UNIFORM TEXT COLOR + RESTORE BADGES (RARITY/ELEMENT)
   - Keeps overall purple gradient readability
   - Prevents any black text on optimizer badges/cards
   - Ensures badge classes used across variants (.tag / .slotChip / .badge) display correctly
   ========================================================= */

/* 1) Never render black text on the purple UI */
#platoonsGrid .platoonSlotCard,
#platoonsGrid .platoonSlotCard * ,
#storyMain .storySlotCard,
#storyMain .storySlotCard *,
#storyBack .storySlotCard,
#storyBack .storySlotCard *,
.slotCard,
.slotCard *{
  color: var(--text) !important;
}

/* Keep muted text muted */
#platoonsGrid .platoonSlotCard .slotTitle,
#platoonsGrid .platoonSlotCard .muted,
.slotSub,
.slotSub *,
.unitSub,
.unitTitle,
.leaderDesc{
  color: var(--muted) !important;
}

/* Light element previously forced dark text; keep uniform */
.slotCard.el-light,
#storyMain .storySlotCard.el-light,
#storyBack .storySlotCard.el-light{
  color: var(--text) !important;
}

/* 2) Badge base styles (covers different markup variants) */
.tag,
.slotChip,
.badge{
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: 4px 8px !important;
  border-radius: 999px !important;
  font-size: 11px !important;
  font-weight: 800 !important;
  letter-spacing: .2px !important;
  border: 1px solid rgba(255,255,255,.18) !important;
  background: rgba(255,255,255,.08) !important;
  color: var(--text) !important;
  white-space: nowrap !important;
}

/* Ensure badge rows are visible */
.slotMetaRow,
.slotBadges{
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 6px !important;
  align-items: center !important;
  justify-content: center !important;
}

/* 3) Element badge colors (supports .tag.element.<el>, .slotChip.element.<el>, .badge.element.<el>) */
.tag.element.fire,  .slotChip.element.fire,  .badge.element.fire  { background: rgba(255, 80, 80, 0.22) !important; border-color: rgba(255, 80, 80, 0.35) !important; }
.tag.element.water, .slotChip.element.water, .badge.element.water { background: rgba(80, 160, 255, 0.22) !important; border-color: rgba(80, 160, 255, 0.35) !important; }
.tag.element.storm, .slotChip.element.storm, .badge.element.storm { background: rgba(255, 220, 80, 0.22) !important; border-color: rgba(255, 220, 80, 0.35) !important; }
.tag.element.earth, .slotChip.element.earth, .badge.element.earth { background: rgba(90, 220, 120, 0.22) !important; border-color: rgba(90, 220, 120, 0.35) !important; }
.tag.element.dark,  .slotChip.element.dark,  .badge.element.dark  { background: rgba(170, 90, 255, 0.22) !important; border-color: rgba(170, 90, 255, 0.35) !important; }

/* Light element: keep WHITE text, darken the background slightly for contrast */
.tag.element.light, .slotChip.element.light, .badge.element.light{
  background: color-mix(in srgb, var(--el-light) 35%, #000) !important;
  border-color: rgba(255,255,255,0.30) !important;
  color: var(--text) !important;
}

/* 4) Rarity badges (supports .tag.rarity, .slotChip.rarity, .badge.rarity) */
.tag.rarity, .slotChip.rarity, .badge.rarity{
  background: rgba(255,255,255,.12) !important;
}

/* If someone uses lowercase rarity tokens */
.tag.rarity.ssr, .slotChip.rarity.ssr, .badge.rarity.ssr{
  background: rgba(255,255,255,.14) !important;
}


/* =========================================================
   CATALOG: BOSSES PAGE — BADGE PARITY (ELEMENT + RARITY)
   Goal:
   - Boss cards use the same badge look as roster/catalog cards
   - No black text on the purple UI
   - Works regardless of whether bosses use #bossGrid, #bossesGrid, or .bossCard
   ========================================================= */

/* Keep bosses text readable on the purple gradient */
#bossGrid, #bossesGrid, #bossCatalogGrid,
#bossGrid *, #bossesGrid *, #bossCatalogGrid *,
.bossCard, .bossCard *{
  color: var(--text);
}

/* Ensure badge rows render like the rest of the app */
#bossGrid .tags, #bossesGrid .tags, #bossCatalogGrid .tags,
#bossGrid .bossBadges, #bossesGrid .bossBadges, #bossCatalogGrid .bossBadges,
#bossGrid .slotBadges, #bossesGrid .slotBadges, #bossCatalogGrid .slotBadges{
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}

/* Element badge tints (scoped to bosses containers + boss cards) */
#bossGrid .tag.element.fire,  #bossesGrid .tag.element.fire,  #bossCatalogGrid .tag.element.fire,  .bossCard .tag.element.fire  { background: rgba(255, 80, 80, 0.22); border-color: rgba(255, 80, 80, 0.35); }
#bossGrid .tag.element.water, #bossesGrid .tag.element.water, #bossCatalogGrid .tag.element.water, .bossCard .tag.element.water { background: rgba(80, 160, 255, 0.22); border-color: rgba(80, 160, 255, 0.35); }
#bossGrid .tag.element.storm, #bossesGrid .tag.element.storm, #bossCatalogGrid .tag.element.storm, .bossCard .tag.element.storm { background: rgba(255, 220, 80, 0.22); border-color: rgba(255, 220, 80, 0.35); }
#bossGrid .tag.element.earth, #bossesGrid .tag.element.earth, #bossCatalogGrid .tag.element.earth, .bossCard .tag.element.earth { background: rgba(90, 220, 120, 0.22); border-color: rgba(90, 220, 120, 0.35); }
#bossGrid .tag.element.dark,  #bossesGrid .tag.element.dark,  #bossCatalogGrid .tag.element.dark,  .bossCard .tag.element.dark  { background: rgba(170, 90, 255, 0.22); border-color: rgba(170, 90, 255, 0.35); }

/* Light element: keep uniform text (no black) */
#bossGrid .tag.element.light, #bossesGrid .tag.element.light, #bossCatalogGrid .tag.element.light, .bossCard .tag.element.light{
  background: color-mix(in srgb, var(--el-light) 35%, #000);
  border-color: rgba(255,255,255,0.30);
  color: var(--text);
}

/* Rarity badge styling (bosses) */
#bossGrid .tag.rarity, #bossesGrid .tag.rarity, #bossCatalogGrid .tag.rarity, .bossCard .tag.rarity{
  background: rgba(255,255,255,.12);
}
